name: Run Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  # No schedules, no automatic training/deployment

jobs:
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # 30 minute timeout
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest pytest-cov  # Testing framework
    
    - name: Run unit tests
      run: |
        python -m pytest tests/ -v --cov=scripts --tb=short
    
    - name: Run specific test functions
      run: |
        # Run your test functions directly
        python scripts/test_functions.py
    
    - name: Check code quality
      run: |
        pip install black flake8
        echo "Checking code formatting..."
        black --check scripts/ tests/ || echo "Formatting issues found"
        echo "Checking code style..."
        flake8 scripts/ tests/ --max-line-length=88 || echo "Style issues found"

  validate:
    runs-on: ubuntu-latest
    needs: test  # Only run if tests pass
    if: success()  # This job only runs if test job succeeds
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Validate scripts can be imported
      run: |
        python -c "from scripts import train, inference; print(' Scripts import successfully')"
    
    - name: Check for required files
      run: |
        echo "Validating project structure..."
        [ -f "requirements.txt" ] || echo " Missing requirements.txt"
        [ -f "scripts/train.py" ] || echo " Missing train.py"
        [ -f "scripts/inference.py" ] || echo " Missing inference.py"
        [ -d "tests/" ] || echo " No tests directory"